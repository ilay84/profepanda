{% extends "base.html" %}
{% block title %}{{ t('Glosarios', 'Glossaries', app_lang) }}{% endblock %}
{% block admin_nav %}{% include "_admin_bar.html" %}{% endblock %}
{% block content %}
  <div class="ppx-container">
    <h1 style="font-family:var(--ppx-font,'Montserrat',sans-serif); font-weight:700;">
      {{ t('Glosarios regionales', 'Regional Glossaries', app_lang) }}
    </h1>
    <p style="opacity:.85;">{{ t('Listado básico de entradas. La edición llegará luego.', 'Basic list of entries. Editing UI coming next.', app_lang) }}</p>

    <div style="margin:.5rem 0 1rem;">
      <button id="rg-validate" style="padding:.5rem .8rem; border:1px solid #4f46e5; background:#4f46e5; color:#fff; border-radius:8px;">{{ t('Validar esquema', 'Validate schema', app_lang) }}</button>
      <span id="rg-val-status" style="margin-left:.75rem; font-weight:600;"></span>
    </div>

    <table style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th style="text-align:left; border-bottom:1px solid #e5e7eb; padding:.5rem;">{{ t('Palabra', 'Word', app_lang) }}</th>
          <th style="text-align:left; border-bottom:1px solid #e5e7eb; padding:.5rem;">Slug</th>
          <th style="text-align:left; border-bottom:1px solid #e5e7eb; padding:.5rem;">{{ t('Países', 'Countries', app_lang) }}</th>
        </tr>
      </thead>
      <tbody>
        {% for it in items %}
        <tr>
          <td style="border-bottom:1px solid #f1f5f9; padding:.5rem;">{{ it.word }}</td>
          <td style="border-bottom:1px solid #f1f5f9; padding:.5rem;">{{ it.slug }}</td>
          <td style="border-bottom:1px solid #f1f5f9; padding:.5rem;">{{ ', '.join(it.countries) }}</td>
        </tr>
        {% else %}
        <tr>
          <td colspan="3" style="padding:.75rem; opacity:.7;">{{ t('No hay entradas aún', 'No entries yet', app_lang) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
{% block scripts %}
  {{ super() }}
  <script>
  (function(){
    const $btn = document.getElementById('rg-validate');
    const $st = document.getElementById('rg-val-status');
    async function run(){
      $st.textContent = '{{ t('Validando…', 'Validating…', app_lang) }}';
      try {
        const r = await fetch('/admin/glossary/api/validate', { headers: { 'Accept': 'application/json' }});
        const data = await r.json();
        if (data.ok){
          $st.textContent = '{{ t('Todo OK', 'All good', app_lang) }}';
          $st.style.color = '#16a34a';
        } else {
          $st.textContent = (data.total_errors||0) + ' {{ t('errores', 'errors', app_lang) }}';
          $st.style.color = '#dc2626';
          console.warn(data);
        }
      } catch (e){
        $st.textContent = 'Error';
        $st.style.color = '#dc2626';
      }
    }
    $btn.addEventListener('click', run);
  })();
  </script>
{% endblock %}
